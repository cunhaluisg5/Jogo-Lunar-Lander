<!DOCTYPE html>
<html>
<head>
	<title>Lunar Lander</title>
	<meta charset="utf-8">
	<style>
		body{
			width: 500px;
			margin: auto;
			text-align: center;
		}
		canvas{
			border: 1px solid black;
			background-color: #b6b6ea;
		}
	</style>
	<script src="Sprite.js"></script>
</head>
<body>
	<h1>Lunar Lander</h1>
	<canvas></canvas>
	<script>
		var antes = new Date();
		var agora = new Date();
		var dt = 0;
		var fps = 0;
		var eCanvas = document.getElementsByTagName("canvas")[0];
		var ctx = eCanvas.getContext("2d");
		eCanvas.width = 400;
    	eCanvas.height = 200;
    	var pc = new Sprite();
    	pc.x = 150;
    	pc.y = 20;
    	pc.vidas = 3;
    	pc.color = "red";
    	var base = new Sprite();
    	base .x = 10;
    	base.y = 190;
		requestAnimationFrame(passo);

		function passo(){
			requestAnimationFrame(passo);
			agora = new Date();
			dt = (agora - antes) / 1000;
			ctx.clearRect(0, 0, eCanvas.width, eCanvas.height);
			ctx.strokeText("Fps: " + Math.floor(1 / dt), 10, 20);
			ctx.strokeText("Vidas: " + pc.vidas, 10, 40);
			pc.mover(dt);
			pc.desenhar(ctx);
			base.desenhar(ctx);

			if(pc.colidiuComLimites(eCanvas)){
				pc.vidas--;
				pc.x = 150;
    			pc.y = 20;
    			pc.vx = 0;
    			pc.vy = 0;
			}

			if(pc.colidiuComBase(base)){
		        if(pc.vy < 20 && Math.abs(pc.vx) < 10){
		          pc.vidas++;
		          pc.vy = 0;
		          pc.vx = 0;
		          base.x = Math.random()*eCanvas.width;
		          base.y = 190;
		        }else{
		          pc.vidas--;
		          pc.x = 150;
		          pc.y = 20;
		          pc.vy = 0;
		          pc.vx = 0;
		        }
		      }

			antes = agora;
		}

		addEventListener("keydown", teclaPressionada);
		addEventListener("keyup", teclaSolta);

		function teclaPressionada(evento){
			switch(evento.keyCode){
				case 37:
					pc.ax = -pc.vm;
					evento.preventDefault();
					break;
				case 39:
					pc.ax = +pc.vm;
					evento.preventDefault();
					break;
				case 38:
					pc.ay = -pc.vm;
					evento.preventDefault();
					break;
				case 40:
					pc.ay = +pc.vm;
					evento.preventDefault();
					break;
				default:
					pc.ax = 0;
					pc.ay = 0;
			}
		}

		function teclaSolta(evento){
			switch(evento.keyCode){
				case 37:
				case 39:
					pc.ax = 0;
					break;
				case 38:
				case 40:
					pc.ay = 0;
					break;
			}
		}
	</script>
</body>
</html>